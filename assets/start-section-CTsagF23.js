var N=Object.defineProperty;var M=(a,e,t)=>e in a?N(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>M(a,typeof e!="symbol"?e+"":e,t);import{a as A,i as B,E,I as v,b as f,V as u,L as b,O as S,v as R,c as O,l as P,d as x,e as D,f as _,P as g,g as F,B as c,h as p,j as h,u as U,t as k,T as I,s as H,k as y,R as V,p as Y,M as j,m as X}from"./index-B11IAplt.js";const $="as_found-options-list.json";class W{saveDataToFile(e){const t=new Blob([JSON.stringify(e)],{type:"application/json"}),s=A({});s.href=URL.createObjectURL(t),s.download=$,s.click()}async loadDataFromFile(){const e=B({});e.type="file",e.accept="application/json";const t=await new Promise((s,o)=>{e.addEventListener("change",()=>{var r;if(!((r=e.files)!=null&&r.length)){o(new Error(E.FILE_SELECT_ERROR));return}s(e.files[v.FIRST_INDEX])}),e.dispatchEvent(new MouseEvent("click"))});if(!t)throw new Error(E.FILE_SELECT_ERROR);try{const s=await t.text(),o=JSON.parse(s);return f(o),o}catch{throw new Error(E.INVALID_FILE_TYPE_ERROR)}}}class J{parseTextInput(e){return e.split(`
`).filter(n=>n!=="").filter(n=>n.includes(",")).map(n=>{const d=n.lastIndexOf(","),m=n.slice(v.FIRST_INDEX,d).trim(),L=n.slice(d+v.INDEX_INCREMENT).trim(),w=L===""?u.EMPTY_QUANTITY:Number(L);return Number.isNaN(w)?null:{title:m,weight:w}}).filter(n=>n!==null)}}class Q{constructor(e){i(this,"model");i(this,"fileService");i(this,"textareaService");i(this,"localStorageService");this.model=e,this.fileService=new W,this.textareaService=new J,this.localStorageService=new b,this.getLocalStorageData()}addOption(e){const t=this.model.getIdAndIncrement(),s=new S(t,e==null?void 0:e.title,e==null?void 0:e.weight);return this.model.addOption(s),this.updateLocalStorage(),s}removeOption(e){this.model.removeOption(e),this.updateLocalStorage()}updateOption(e){this.model.updateOptionProperties(e),this.updateLocalStorage()}getOptions(){return this.model.getOptions()}clearList(){this.model.clearOptions(),this.updateLocalStorage()}saveListToFile(){const e=this.model.getListData();this.fileService.saveDataToFile(e)}async loadListFromFile(){const e=await this.fileService.loadDataFromFile();this.clearList(),this.model.setListData(e),this.updateLocalStorage()}pasteList(e){const t=this.textareaService.parseTextInput(e),s=[];for(const o of t){const r=this.addOption(o);s.push(r)}return this.updateLocalStorage(),s}validateOptionsCount(){return R(this.model.getOptions())}updateLocalStorage(){const e=this.model.getListData();this.localStorageService.saveListData(e)}getLocalStorageData(){const e=this.localStorageService.loadListData();e?this.model.setListData(e):this.addOption()}}class Z{constructor(e=u.INITIAL_ID,t=[]){i(this,"options",new Map);i(this,"idCounter");this.idCounter=e;for(const s of t)this.addOption(s)}getOptions(){return[...this.options.values()]}addOption(e){this.options.set(e.id,e)}removeOption(e){this.options.delete(e),this.options.size===u.EMPTY_MAP_SIZE&&this.resetIDCounter()}clearOptions(){this.options.clear(),this.resetIDCounter()}updateOptionProperties(e){const t=this.options.get(e.id);t&&(t.title=e.title,t.weight=e.weight,this.options.set(t.id,t))}getIdAndIncrement(){const e=this.idCounter;return this.idCounter+=u.ID_INCREMENT,e}getListData(){const e=[...this.options.values()],t=this.idCounter;return{list:e,lastId:t}}setListData(e){this.idCounter=e.lastId;for(const t of e.list)this.options.set(t.id,new S(t.id,t.title,t.weight))}resetIDCounter(){this.idCounter=u.INITIAL_ID}}const z="_item_r5jcp_1",G="_id_r5jcp_16",K="_title_r5jcp_21",q="_weight_r5jcp_28",T={item:z,id:G,title:K,weight:q};class tt extends O{constructor({id:t,title:s,weight:o},r,n){super();i(this,"id");i(this,"view");i(this,"title");i(this,"weight");i(this,"childListeners",[]);i(this,"removeOptionCallback");i(this,"updateOptionCallback");this.id=t,this.title=s,this.weight=o,this.removeOptionCallback=r,this.updateOptionCallback=n,this.view=this.createHTML()}onClear(){for(const t of this.childListeners)t();this.removeElement()}createHTML(){const t=`#${String(this.id)}`,s=P({className:T.item}),o=x({textContent:t,className:T.id});o.setAttribute(D.FOR,t);const r=new _({placeholder:g.TITLE,className:T.title,attributes:{id:t}}).getHTML();this.title&&(r.value=this.title),r.addEventListener("input",()=>{this.title=r.value,this.updatePropertiesInModel()});const n=new _({placeholder:g.WEIGHT,className:T.weight,attributes:{type:F.TYPE_NUMBER}}).getHTML();this.weight>u.EMPTY_QUANTITY&&(n.value=String(this.weight)),n.addEventListener("input",()=>{this.weight=Number(n.value),this.updatePropertiesInModel()});const d=this.createDeleteButton(s);return s.append(o,r,n,d),s}createDeleteButton(t){const s=new c({textContent:h.DELETE,type:p.TYPE_BUTTON,onClick:()=>{s.removeListener(),s.removeElement(),t.remove(),this.removeOptionCallback(this.id)}});return this.childListeners.push(()=>{s.removeListener()}),s.getHTML()}updatePropertiesInModel(){const t=new S(this.id,this.title,this.weight);this.updateOptionCallback(t)}}const et="_list_8k6d4_1",st={list:et};class it extends O{constructor(t){super();i(this,"view");i(this,"options",new Map);i(this,"controller");this.controller=t,this.view=this.createHTML()}addOption(){const t=this.controller.addOption();this.createAndAppendOption(t,this.view)}clearList(){this.controller.clearList(),this.clearView()}saveListToFile(){this.controller.saveListToFile()}loadListFromFile(){this.controller.loadListFromFile().then(()=>{this.clearView();for(const t of this.controller.getOptions())this.createAndAppendOption(t,this.view)}).catch(()=>{throw new Error(E.FILE_LOAD_ERROR)})}pasteList(t){const s=this.controller.pasteList(t);for(const o of s)this.createAndAppendOption(o,this.view)}clearView(){this.view.replaceChildren();for(const t of this.options.values())t.onClear();this.options.clear()}createHTML(){const t=U({className:st.list});for(const s of this.controller.getOptions())this.createAndAppendOption(s,t);return t}createOptionItem(t){const s=new tt(t,this.controller.removeOption.bind(this.controller),this.controller.updateOption.bind(this.controller));return this.options.set(s.id,s),s}createAndAppendOption(t,s){const o=this.createOptionItem(t);s.append(o.getHTML())}}const ot="_textarea_pdrmb_1",nt={textarea:ot};class rt extends O{constructor(t,s){super();i(this,"view");i(this,"columns");i(this,"rows");this.columns=t,this.rows=s,this.view=this.createHTML()}getValue(){return this.view.value}createHTML(){const t=k({className:nt.textarea});return t.placeholder=g.TEXTAREA,t.setAttribute(I.COLUMNS,this.columns),t.setAttribute(I.ROWS,this.rows),t}}const C={COLUMNS:"60",ROWS:"10"},at="_section_19kjb_1",lt="_container_19kjb_7",ct="_button_19kjb_17",l={section:at,container:lt,button:ct};class dt extends O{constructor(t){super();i(this,"view");i(this,"optionsListModel");i(this,"optionsList");i(this,"optionsListController");i(this,"router");i(this,"childListeners",[]);this.router=t,this.optionsListModel=new Z,this.optionsListController=new Q(this.optionsListModel),this.optionsList=new it(this.optionsListController),this.view=this.createHTML()}onRemove(){this.optionsList.clearView();for(const t of this.childListeners)t()}createHTML(){const t=H({className:l.section}),s=y({className:l.container}),o=this.createAddOptionButton(),r=this.createClearListButton(),n=this.createSaveListButton(),d=this.createLoadListButton(),m=this.createPasteListButton(),L=this.createStartButton();return s.append(o,r,m,n,d,L),t.append(this.optionsList.getHTML(),s),t}createAddOptionButton(){const t=new c({className:l.button,textContent:h.ADD_OPTION,type:p.TYPE_BUTTON,onClick:()=>{this.optionsList.addOption()}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}createClearListButton(){const t=new c({className:l.button,textContent:h.CLEAR_LIST,type:p.TYPE_BUTTON,onClick:()=>{this.optionsList.clearList()}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}createSaveListButton(){const t=new c({className:l.button,textContent:h.SAVE_LIST,type:p.TYPE_BUTTON,onClick:()=>{this.optionsList.saveListToFile()}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}createLoadListButton(){const t=new c({className:l.button,textContent:h.LOAD_LIST,type:p.TYPE_BUTTON,onClick:()=>{this.optionsList.loadListFromFile()}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}createPasteListButton(){const t=new c({className:l.button,textContent:h.PASTE_LIST,type:p.TYPE_BUTTON,onClick:()=>{const s=new rt(C.COLUMNS,C.ROWS);this.openModal(s.getHTML(),!0,()=>{this.optionsList.pasteList(s.getValue())})}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}createStartButton(){const t=new c({className:l.button,textContent:h.START,type:p.TYPE_BUTTON,actionButton:!0,onClick:()=>{if(this.optionsListController.validateOptionsCount())this.router.navigate(V.PICKER);else{const s=Y({},[j.INVALID_OPTIONS_COUNT]);this.openModal(s,!1)}}});return this.childListeners.push(()=>{t.removeListener()}),t.getHTML()}openModal(t,s,o){const r=new X(t,s,o);document.body.prepend(r.getHTML()),r.showModal()}}export{dt as default};
